var extendEchart={};var seriesPool={};extendEchart.initEchart=function(t,e){var a={};a.gridId="#"+t+"_extendEchart_gridTable";a.divId=t;var r=$("#"+t).height();var n=(r-30)*.7;var i=(r-30)*.3;var l="<div style='width: 100%;min-height: 30px;background-color:#f2f8fe ' id='"+t+"_extendEchart_controlDiv'></div>"+"<div style='width: 100%;height:"+n+"px;' id='"+t+"_extendEchart_contentDiv'></div>"+"<div style='width: 90%;margin-right: 5%;margin-left: 5%'><table style='width: 100%;height:"+i+"px;' id='"+t+"_extendEchart_gridTable'></table></div>";$("#"+t).html(l);var d=echarts.init($("#"+t+"_extendEchart_contentDiv")[0]);var o=e.series;var s=$.extend(true,{},o);seriesPool[t]=s;s=extendEchart.formatObjectToArray(s);a.oldSeries=s;for(var c in o){o[c].data=extendEchart.getValueArrayByJson(o[c].data)}var u={};var h=[];if(e.legend!=null){u=e.legend}else{for(var c in o){h.push(o[c].name)}u.x="right";u.data=h}var x=null;var f=null;if(e.xAxis!=null||e.yAxis!=null){f={};x={}}if(e.xAxis!=null){f=$.extend(true,{},e.xAxis);f.data=extendEchart.getValueArrayByJson(e.xAxis.data)}if(e.yAxis!=null){x=e.yAxis}var v={};if(e.tooltip!=null){v=e.tooltip}var g=null;if(e.dataZoom!=null){g=e.dataZoom}var y=null;if(e.title!=null){y=e.title}var m=null;if(e.textStyle!=null){m=e.textStyle}var E=null;if(e.color!=null){E=e.color}var p=null;if(e.grid!=null){p=e.grid}var A={title:y,xAxis:f,yAxis:x,legend:u,series:o,textStyle:m,tooltip:v,dataZoom:g,grid:p};if(null!=E){A.color=E}a.option=A;d.setOption(A);if(e.xAxis!=null&&e.xAxis.data!=null){var J="<div style='text-align: left'>";var _=e.xAxis.data;$.each(_,function(e,a){J+='<label style="cursor:pointer;font-weight: normal;font-family: \'microsoft yahei\', Microsoft YaHei, STXihei, SimHei, SimSun, sans-serif"><input class="'+t+'lxj_checkbox" style="margin-left: 40px;margin-top: 8px;"  type="checkbox" checked id="divId_checkbox_'+e+'" />'+a+" </label>"});$("#"+t+"_extendEchart_controlDiv").html(J)}var b={};if(e.xAxis!=null&&e.xAxis.data!=null){b=extendEchart.getCloumnsByJson(e.xAxis.data)}else if(e.columns!=null){b=extendEchart.getCloumnsByJson(e.columns)}var O=$("#"+t+"_extendEchart_gridTable").datagrid({height:i,autoRowHeight:true,pagination:false,sortOrder:"desc",remoteSort:false,singleSelect:true,fitColumns:true,columns:b});$("#"+t+"_extendEchart_gridTable").datagrid("loadData",extendEchart.getGriddataByJson(s,null,e.columns));a.grid=O;var B=$.extend(true,{},s);B=extendEchart.formatObjectToArray(B);$("."+t+"lxj_checkbox").on("click",function(){var r=$("."+t+"lxj_checkbox").not("input:checked");var n=JSON.parse(JSON.stringify(_));B=$.extend(true,{},s);B=extendEchart.formatObjectToArray(B);r.each(function(t){var e=$(this).attr("id").substring($(this).attr("id").lastIndexOf("_")+1);delete n[e];for(var a in B){var r=B[a].data;delete r[e]}});var i=$.extend(true,{},B);i=extendEchart.formatObjectToArray(i);for(var l in i){i[l].data=extendEchart.getValueArrayByJson(i[l].data)}var o={xAxis:{data:extendEchart.getValueArrayByJson(n)},title:y,legend:u,yAxis:x,series:i,textStyle:m,tooltip:v,dataZoom:g,grid:p};if(null!=E){o.color=E}d.setOption(o,true);a.option=o;$("#"+t+"_extendEchart_gridTable").datagrid({columns:extendEchart.getCloumnsByJson(n)});$("#"+t+"_extendEchart_gridTable").datagrid("loadData",extendEchart.getGriddataByJson(B,u,e.columns))});d.on("legendselectchanged",function(a){u.selected=a.selected;var r=null;if(e.columns!=null){r=e.columns}$("#"+t+"_extendEchart_gridTable").datagrid("loadData",extendEchart.getGriddataByJson(s,u,r))});a.csntchart=d;return a};extendEchart.getValueArrayByJson=function(t){if(!(t instanceof Array)){if(t!=null){var e=[];$.each(t,function(t,a){e.push(a)});return e}}else{return t}};extendEchart.getCloumnsByJson=function(t){if(t!=null){var e=[];var a=[];var r=extendEchart.getJsonLength(t);var n;if(r<15){var n=1e3/(extendEchart.getJsonLength(t)+1)}else{n="150px"}a.push({title:"系列",field:"csntTitle",width:n,formatter:function(t,e,a){return"<span style='color: #47d2ee'><i class='fa fa-fw fa-cube'></i></span> "+t}});$.each(t,function(t,e){a.push({title:e,field:t,width:n})});e.push(a);return e}};extendEchart.getGriddataByJson=function(t,e,a){if(t!=null){var r={};var n=[];var i={};if(e!=null&&e.selected!=null){i=e.selected}for(var l in t){if(!(t[l].data instanceof Array)){var d=JSON.parse(JSON.stringify(t[l].data));var o=t[l].name;d.csntTitle=o;if(null!=i[o]&&!i[o]){continue}n.push(d)}else{var d={};var o=t[l].name;d.csntTitle=o;if(null!=i[o]&&!i[o]){continue}for(var s in t[l].data){var c=extendEchart.getNameByValueOfJson(a,t[l].data[s].name);d[c]=t[l].data[s].value}n.push(d)}}r.total=n.length;r.rows=n;return r}};extendEchart.getNameByValueOfJson=function(t,e){var a=null;$.each(t,function(t,r){if(r==e){a=t}});return a};extendEchart.getJsonLength=function(t){var e=null;$.each(t,function(t,a){e++});return e};extendEchart.formatObjectToArray=function(t){var e=[];for(var a in t){e.push(t[a])}return e};extendEchart.loadData=function(t,e,a,r){var n=t.option;var i=t.csntchart;var l=t.gridId;var d=t.divId;var o=n.legend;for(var s in e){$.each(e[s],function(t,e){seriesPool[d][s][t]=e})}var c=null;if(r!=null){c=r}if(a){var u=$(".lxj_checkbox").not("input:checked");var h=JSON.parse(JSON.stringify(c.data));var x=$.extend(true,{},seriesPool[d]);x=extendEchart.formatObjectToArray(x);u.each(function(t){var e=$(this).attr("id").substring($(this).attr("id").lastIndexOf("_")+1);delete h[e];for(var a in x){var r=x[a].data;delete r[e]}});var f=$(l).datagrid({columns:extendEchart.getCloumnsByJson(h)});$(l).datagrid("loadData",extendEchart.getGriddataByJson(x,o));for(var s in x){x[s].data=extendEchart.getValueArrayByJson(x[s].data)}n.series=x;if(c!=null){n.xAxis.data=extendEchart.getValueArrayByJson(c.data)}i.setOption(n,true)}else{var u=$(".lxj_checkbox").not("input:checked");var h=JSON.parse(JSON.stringify(c.data));var x=$.extend(true,{},seriesPool[d]);x=extendEchart.formatObjectToArray(x);u.each(function(t){var e=$(this).attr("id").substring($(this).attr("id").lastIndexOf("_")+1);delete h[e];for(var a in x){var r=x[a].data;delete r[e]}});var f=$(l).datagrid({columns:extendEchart.getCloumnsByJson(h)});$(l).datagrid("loadData",extendEchart.getGriddataByJson(x,o));for(var s in x){x[s].data=extendEchart.getValueArrayByJson(x[s].data)}n.series=x;if(c!=null){n.xAxis.data=extendEchart.getValueArrayByJson(c.data)}i.setOption(n)}};